"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.expandConfig = void 0;
const api_js_1 = require("./api.js");
const uri_js_1 = require("./uri.js");
function expandConfig(config) {
    const uri = (0, uri_js_1.parseUri)(config.url);
    let authToken = config.authToken;
    for (const { key, value } of uri.query?.pairs ?? []) {
        if (key === "authToken") {
            authToken = value ? value : undefined;
        }
        else {
            throw new api_js_1.LibsqlError(`Unknown URL query parameter ${JSON.stringify(key)}`, "URL_PARAM_NOT_SUPPORTED");
        }
    }
    if (uri.fragment !== undefined) {
        throw new api_js_1.LibsqlError(`URL fragments are not supported: ${JSON.stringify("#" + uri.fragment)}`, "URL_INVALID");
    }
    return {
        scheme: uri.scheme,
        authority: uri.authority,
        path: uri.path,
        authToken,
    };
}
exports.expandConfig = expandConfig;
